@(title: String)(content: Html)(implicit request: play.api.mvc.Request[AnyContent], user: Option[auth.Account])

@* check for the pjax header *@
@if(request.headers.get("X-PJAX").isDefined) {
        <title>@title</title>

        @content

        <script>console.log("pjax template loaded");</script>
} else {
@* normal request, not pjax *@

<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>@title</title>
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/main.css")">
        <link rel="stylesheet" media="screen" href="@routes.WebJarAssets.at("bootstrap/2.1.1/css/bootstrap.min.css")">
        
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.at("images/favicon.png")">

        <style type="text/css">
          body {
            padding-top: 60px;
            padding-bottom: 40px;
          }
        </style>

        <link rel="stylesheet" media="screen" href="@routes.WebJarAssets.at("bootstrap/2.1.1/css/bootstrap-responsive.min.css")">

        <script src="@routes.WebJarAssets.at("jquery/1.8.2/jquery.min.js")"></script>
        <script type="text/javascript" src="@routes.Assets.at("javascripts/libs/jquery.validate.js")"></script>
        <script src="@routes.WebJarAssets.at("bootstrap/2.1.1/js/bootstrap.min.js")"></script>

    </head>
    <body>

      @views.html.topbar(user)

      <div id="contentArea">
        @content
      </div>

      @* Load and call pjax lib *@
      <script src="@routes.Assets.at("javascripts/libs/jquery.pjax.js")" type="text/javascript"></script>
      <script type="text/javascript">
          //some logging to mark if we are in a pjax request or not in the JS console
          console.log("normal request template loaded");

          $(function(){
              //we only set pjax if the browser supports it
              if($.support.pjax) {

                  //This code ensures that we won't use Pjax if the user has pressed a modifier key when clicking,
                  //as some OS/browsers may have special behaviour linked to it
                  $(document).on("click", "a.js-pjax", function(event) {
                      if (!event.altKey && !event.ctrlKey && !event.metaKey && !event.shiftKey) {
                          event.preventDefault();
                          //call pjax
                          console.log("Ready to call Pjax");
                          $.pjax({
                              url: $(this).attr('href'),
                              container: '#contentArea',
                              timeout: null,
                              error: function(xhr, err){
                                  alert('Something went wrong: ' + err)
                              }
                          });
                      } else {
                          console.log("Modifier key pressed, no Pjax call executed");
                      }
                  });

                  //uncomment to outline the anchors that have pjax enabled
                  //$('.js-pjax]').css("border", "3px double red");


                  //below we have all Pjax events. They print a message on console to see the order

                  //start and end are relevant for user feedback. On slow mobile networks the Pjax request may be slow
                  //and if we don't give visual feedback (like a "loading" gif) the user may believe that the site is broken
                  $('#contentArea').on('pjax:start', function() { console.log("pjax:start"); });
                  $('#contentArea').on('pjax:end',   function() { console.log("pjax:end"); });

                  //Other events
                  $('#contentArea').on('pjax:beforeSend',   function() { console.log("pjax:beforeSend"); });
                  $('#contentArea').on('pjax:complete',   function() { console.log("pjax:complete"); });
                  $('#contentArea').on('pjax:success',   function() { console.log("pjax:success"); });
                  $('#contentArea').on('pjax:error',   function() { console.log("pjax:error"); });
                  $('#contentArea').on('pjax:timeout',   function() { console.log("pjax:timeout"); });
              }
          });
      </script>
    </body>
</html>
} @* end else *@
